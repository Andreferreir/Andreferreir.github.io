<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AeroHelp v3.2 - Clean Design</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* Variáveis TAP */
        :root {
            --tap-green: #00874d;
            --tap-red: #e31937;
            --bg-body: #f8fafc; /* Fundo ligeiramente azulado/cinza para contraste */
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-body);
            color: #333;
        }

        /* Classes utilitárias personalizadas */
        .text-tap-green { color: var(--tap-green); }
        .bg-tap-green { background-color: var(--tap-green); }
        .text-tap-red { color: var(--tap-red); }

        /* Esconder Scrollbar mas manter funcionalidade */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        /* Animação suave para as respostas */
        .accordion-content {
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out, padding 0.3s ease;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .accordion-content.open {
            max-height: 500px; /* Altura suficiente para texto */
            opacity: 1;
        }

        /* Rotação do ícone */
        .icon-rotate { transition: transform 0.3s ease; }
        .icon-rotate.open { transform: rotate(180deg); }
    </style>
</head>
<body class="min-h-screen pb-20">

    <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-tap-green rounded flex items-center justify-center text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h20"/><path d="M20 12v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8"/><path d="m4 8 8-4 8 4"/><path d="m2 12 10 10 10-10"/></svg>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-gray-800">
                    Aero<span class="text-tap-red">Help</span> <span class="text-xs text-gray-400 font-normal">v3.2</span>
                </h1>
            </div>

            <button id="adminToggleBtn" onclick="toggleAdminMode()" class="text-xs font-bold uppercase tracking-wider text-gray-500 hover:text-tap-green border border-gray-200 hover:border-tap-green px-3 py-1.5 rounded-full transition-all bg-gray-50">
                Gerir Conteúdo
            </button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4">

        <div class="py-8">
            <div class="relative shadow-sm rounded-xl">
                <input type="text" id="searchInput" placeholder="Qual a sua dúvida hoje?" 
                    class="w-full pl-12 pr-4 py-4 rounded-xl border border-gray-200 focus:border-tap-green focus:ring-2 focus:ring-green-100 outline-none transition-all text-gray-700 bg-white placeholder-gray-400">
                <svg class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
            </div>
        </div>

        <div class="mb-8">
            <h2 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 ml-1">Navegar por Temas</h2>
            <nav id="categoryContainer" class="flex gap-3 overflow-x-auto hide-scroll pb-2">
                </nav>
        </div>

        <section id="adminPanel" class="hidden mb-10 bg-white border border-gray-200 rounded-xl p-6 shadow-lg animate-fade-in">
            <div class="mb-4 pb-2 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-gray-800">Adicionar Nova Pergunta</h3>
                <button onclick="toggleAdminMode()" class="text-tap-red text-xs font-bold">FECHAR</button>
            </div>
            
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">Categoria</label>
                        <select id="newCategory" onchange="checkNewCategory(this.value)" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:border-tap-green outline-none text-sm"></select>
                        <input type="text" id="customCategoryName" placeholder="Nome do novo tema" class="hidden mt-2 w-full p-2.5 bg-white border border-tap-green rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">Tags</label>
                        <input type="text" id="newKeywords" placeholder="Ex: bagagem, peso" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:border-tap-green outline-none text-sm">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">Pergunta</label>
                    <input type="text" id="newQuestion" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:border-tap-green outline-none font-medium">
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">Resposta</label>
                    <textarea id="newAnswer" rows="3" class="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:border-tap-green outline-none resize-none"></textarea>
                </div>

                <button onclick="addNewFAQ()" class="w-full bg-tap-green hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow transition-colors">
                    Publicar Pergunta
                </button>
            </div>
        </section>

        <div id="faqList" class="flex flex-col gap-4">
            </div>

        <div id="emptyState" class="hidden text-center py-12">
            <p class="text-gray-400">Nenhum resultado encontrado.</p>
        </div>

    </main>

    <script>
        // --- DADOS (Persistência) ---
        const DataManager = {
            init() {
                if (!localStorage.getItem('aero_faqs_v3_2')) {
                    const defaultData = [
                        { id: 101, category: 'Bagagem', question: 'Qual o peso máximo da mala de mão?', answer: 'Na TAP, a mala de mão pode pesar até 10kg na Classe Económica e 10kg na Executiva (2 volumes). Medidas: 55x40x20cm.', keywords: 'mala peso mao' },
                        { id: 102, category: 'Check-in', question: 'Quando abre o check-in online?', answer: 'O check-in online abre 36 horas antes da partida do voo.', keywords: 'checkin tempo' }
                    ];
                    localStorage.setItem('aero_faqs_v3_2', JSON.stringify(defaultData));
                }
                this.syncCategories();
            },

            getFaqs: () => JSON.parse(localStorage.getItem('aero_faqs_v3_2')) || [],
            
            setFaqs: (data) => {
                localStorage.setItem('aero_faqs_v3_2', JSON.stringify(data));
                DataManager.syncCategories();
            },
            
            getCats: () => JSON.parse(localStorage.getItem('aero_cats_v3_2')) || [],

            syncCategories: () => {
                const faqs = JSON.parse(localStorage.getItem('aero_faqs_v3_2')) || [];
                const uniqueCats = [...new Set(faqs.map(item => item.category))].sort();
                localStorage.setItem('aero_cats_v3_2', JSON.stringify(uniqueCats));
            }
        };

        // --- ESTADO ---
        let currentCategory = 'Todas';
        let isAdmin = false;

        window.onload = () => {
            DataManager.init();
            renderUI();
            document.getElementById('searchInput').addEventListener('input', renderFAQs);
        };

        function renderUI() {
            renderCategories();
            renderAdminSelect();
            renderFAQs();
        }

        // Renderiza os botões das categorias
        function renderCategories() {
            const container = document.getElementById('categoryContainer');
            const cats = ['Todas', ...DataManager.getCats()];
            
            container.innerHTML = cats.map(cat => {
                const isActive = currentCategory === cat;
                
                // LÓGICA DE CORES CORRIGIDA:
                // Ativo: Verde TAP, Texto Branco.
                // Inativo: Fundo Cinza Claro, Texto Cinza Escuro, Hover Cinza Médio (NÃO BRANCO).
                const activeClasses = 'bg-tap-green text-white shadow-md border-transparent';
                const inactiveClasses = 'bg-gray-100 text-gray-600 border-transparent hover:bg-gray-200 hover:text-black';

                return `
                <button onclick="setCategory('${cat}')" 
                    class="px-5 py-2 rounded-full text-sm font-bold transition-colors whitespace-nowrap border ${isActive ? activeClasses : inactiveClasses}">
                    ${cat}
                </button>
            `}).join('');
        }

        function renderAdminSelect() {
            const select = document.getElementById('newCategory');
            const cats = DataManager.getCats();
            let html = cats.map(c => `<option value="${c}">${c}</option>`).join('');
            html += `<option value="NEW_THEME" class="font-bold text-tap-red">+ Novo Tema</option>`;
            select.innerHTML = html;
        }

        function renderFAQs() {
            const container = document.getElementById('faqList');
            const emptyState = document.getElementById('emptyState');
            const term = document.getElementById('searchInput').value.toLowerCase();
            const faqs = DataManager.getFaqs();

            const filtered = faqs.filter(f => {
                const matchesTerm = f.question.toLowerCase().includes(term) || f.keywords.toLowerCase().includes(term);
                const matchesCat = currentCategory === 'Todas' || f.category === currentCategory;
                return matchesTerm && matchesCat;
            });

            if (filtered.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            } else {
                emptyState.classList.add('hidden');
            }

            container.innerHTML = filtered.map(f => `
                <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden hover:border-gray-300 transition-colors">
                    <button onclick="toggleAccordion(${f.id})" class="w-full text-left px-5 py-4 flex justify-between items-center group bg-white">
                        <div>
                            <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider block mb-1">${f.category}</span>
                            <span class="font-bold text-gray-800 group-hover:text-tap-green transition-colors text-base">${f.question}</span>
                        </div>
                        <svg id="icon-${f.id}" class="icon-rotate text-gray-300 w-5 h-5 flex-shrink-0 ml-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                    </button>
                    
                    <div id="ans-${f.id}" class="accordion-content bg-gray-50">
                        <div class="px-5 pb-5 pt-2 text-gray-600 text-sm leading-relaxed">
                            ${f.answer}
                            
                            <div class="${isAdmin ? 'flex' : 'hidden'} justify-end mt-3 pt-3 border-t border-gray-200">
                                <button onclick="deleteFAQ(${f.id})" class="text-xs font-bold text-tap-red hover:bg-red-50 px-2 py-1 rounded transition flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                                    ELIMINAR
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- AÇÕES ---

        function toggleAccordion(id) {
            const content = document.getElementById(`ans-${id}`);
            const icon = document.getElementById(`icon-${id}`);
            const isOpen = content.classList.contains('open');

            // Fecha todos
            document.querySelectorAll('.accordion-content').forEach(el => el.classList.remove('open'));
            document.querySelectorAll('.icon-rotate').forEach(el => el.classList.remove('open'));

            // Abre o clicado se não estava aberto
            if (!isOpen) {
                content.classList.add('open');
                icon.classList.add('open');
            }
        }

        function setCategory(cat) {
            currentCategory = cat;
            renderUI();
        }

        function toggleAdminMode() {
            isAdmin = !isAdmin;
            const panel = document.getElementById('adminPanel');
            const btn = document.getElementById('adminToggleBtn');
            
            if (isAdmin) {
                panel.classList.remove('hidden');
                btn.classList.add('bg-tap-green', 'text-white', 'border-tap-green');
                btn.classList.remove('text-gray-500', 'bg-gray-50');
            } else {
                panel.classList.add('hidden');
                btn.classList.remove('bg-tap-green', 'text-white', 'border-tap-green');
                btn.classList.add('text-gray-500', 'bg-gray-50');
            }
            renderFAQs(); // Re-render para mostrar botões de delete
        }

        function checkNewCategory(val) {
            const input = document.getElementById('customCategoryName');
            if (val === 'NEW_THEME') {
                input.classList.remove('hidden');
                input.focus();
            } else {
                input.classList.add('hidden');
            }
        }

        function addNewFAQ() {
            const q = document.getElementById('newQuestion').value.trim();
            const a = document.getElementById('newAnswer').value.trim();
            const k = document.getElementById('newKeywords').value.trim();
            let c = document.getElementById('newCategory').value;

            if (c === 'NEW_THEME') {
                c = document.getElementById('customCategoryName').value.trim();
                if (!c) return alert("Insira o nome do tema.");
            }

            if (!q || !a) return alert("Preencha a pergunta e a resposta.");

            const faqs = DataManager.getFaqs();
            // Primeira letra maiúscula na categoria
            c = c.charAt(0).toUpperCase() + c.slice(1);

            faqs.unshift({ id: Date.now(), category: c, question: q, answer: a, keywords: k });
            DataManager.setFaqs(faqs);

            // Limpar form
            document.getElementById('newQuestion').value = '';
            document.getElementById('newAnswer').value = '';
            document.getElementById('newKeywords').value = '';
            document.getElementById('customCategoryName').value = '';
            
            alert("Pergunta publicada!");
            toggleAdminMode();
            renderUI();
        }

        function deleteFAQ(id) {
            if (!confirm("Eliminar esta pergunta? Se for a única do tema, o tema também será removido.")) return;

            let faqs = DataManager.getFaqs();
            const target = faqs.find(f => f.id === id);
            
            if (target) {
                const cat = target.category;
                faqs = faqs.filter(f => f.id !== id);
                DataManager.setFaqs(faqs);

                // Verifica se a categoria ainda existe
                const remaining = faqs.filter(f => f.category === cat);
                if (remaining.length === 0 && currentCategory === cat) {
                    currentCategory = 'Todas';
                }
                renderUI();
            }
        }
    </script>
</body>
</html>
