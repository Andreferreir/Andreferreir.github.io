<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Ajuda</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .answer-content {
            transition: all 0.3s ease-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .answer-content.open {
            max-height: 500px; /* Altura máxima estimada */
            opacity: 1;
            margin-top: 1rem;
        }
        .rotate-icon { transition: transform 0.3s; }
        .rotate-icon.open { transform: rotate(180deg); }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">

    <div class="bg-white shadow-sm pb-8 pt-6 px-4">
        <div class="max-w-3xl mx-auto flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-blue-900">Como podemos ajudar?</h1>
            
            <button onclick="toggleAdminMode()" id="adminToggleBtn" class="p-2 rounded-full bg-gray-100 text-gray-400 hover:bg-gray-200 transition">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
            </button>
        </div>

        <div class="max-w-3xl mx-auto relative">
            <div class="absolute left-4 top-3.5 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            </div>
            <input 
                type="text" 
                id="searchInput"
                placeholder="Pesquise por tema (ex: mbway, entrega...)" 
                class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:outline-none shadow-sm transition-all"
                onkeyup="filterFAQs()"
            >
        </div>
    </div>

    <main class="max-w-3xl mx-auto px-4 py-8">
        
        <div class="flex gap-2 mb-8 overflow-x-auto pb-2" id="categoryContainer">
            </div>

        <div id="adminPanel" class="hidden mb-8 p-6 bg-blue-50 border border-blue-100 rounded-xl shadow-inner">
            <h2 class="text-xl font-bold text-blue-900 mb-4 flex items-center gap-2">
                <span>Adicionar Nova Pergunta</span>
                <span class="text-xs bg-blue-200 text-blue-800 px-2 py-1 rounded">Modo Admin</span>
            </h2>
            
            <div class="space-y-3">
                <select id="newCategory" class="w-full p-2 border rounded bg-white">
                    <option value="Pagamentos">Pagamentos</option>
                    <option value="Entregas">Entregas</option>
                    <option value="Conta">Conta</option>
                </select>
                <input type="text" id="newQuestion" placeholder="Escreva a pergunta..." class="w-full p-2 border rounded">
                <textarea id="newAnswer" placeholder="Escreva a resposta..." class="w-full p-2 border rounded h-24"></textarea>
                <input type="text" id="newKeywords" placeholder="Keywords (ex: urgente, dinheiro)" class="w-full p-2 border rounded">
                
                <button onclick="addNewFAQ()" class="bg-blue-600 text-white font-bold py-2 px-6 rounded hover:bg-blue-700 transition w-full sm:w-auto">
                    Guardar
                </button>
            </div>
        </div>

        <div id="faqList" class="space-y-4">
            </div>

    </main>

    <script>
        // 1. DADOS INICIAIS (A nossa "Base de Dados" na memória)
        let faqs = [
            { id: 1, category: 'Pagamentos', question: 'Aceitam MBWay?', answer: 'Sim, aceitamos MBWay e Referência Multibanco.', keywords: 'mbway dinheiro pagar' },
            { id: 2, category: 'Entregas', question: 'Quanto tempo demora a entrega?', answer: 'Entre 24 a 48 horas úteis para Portugal Continental.', keywords: 'envio tempo ctt' },
            { id: 3, category: 'Conta', question: 'Esqueci-me da password', answer: 'Pode recuperar clicando em "Recuperar Senha" no login.', keywords: 'login acesso senha' }
        ];

        const categories = ['Todas', 'Pagamentos', 'Entregas', 'Conta'];
        let currentCategory = 'Todas';
        let isAdmin = false;

        // 2. INICIALIZAÇÃO
        document.addEventListener('DOMContentLoaded', () => {
            renderCategories();
            renderFAQs();
        });

        // 3. RENDERIZAR CATEGORIAS (Botões)
        function renderCategories() {
            const container = document.getElementById('categoryContainer');
            container.innerHTML = categories.map(cat => `
                <button 
                    onclick="setCategory('${cat}')"
                    class="px-4 py-2 rounded-full text-sm font-medium transition-colors border ${currentCategory === cat ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-100'}"
                >
                    ${cat}
                </button>
            `).join('');
        }

        // 4. RENDERIZAR FAQS (Lista)
        function renderFAQs() {
            const container = document.getElementById('faqList');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            // Filtragem
            const filtered = faqs.filter(faq => {
                const matchSearch = faq.question.toLowerCase().includes(searchTerm) || faq.keywords.toLowerCase().includes(searchTerm);
                const matchCat = currentCategory === 'Todas' || faq.category === currentCategory;
                return matchSearch && matchCat;
            });

            if (filtered.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-10">Nenhuma pergunta encontrada.</div>';
                return;
            }

            // Gerar HTML
            container.innerHTML = filtered.map(faq => `
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <button onclick="toggleAnswer(${faq.id})" class="w-full text-left px-6 py-4 flex justify-between items-center hover:bg-gray-50 transition-colors">
                        <span class="font-semibold text-gray-800">${faq.question}</span>
                        <svg id="icon-${faq.id}" class="rotate-icon text-gray-400" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </button>
                    <div id="ans-${faq.id}" class="answer-content bg-gray-50/50 px-6 border-t border-gray-50">
                        <div class="pb-6 pt-2 text-gray-600">
                            ${faq.answer}
                            <div class="mt-2 text-xs text-blue-500 uppercase font-bold tracking-wider">${faq.category}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 5. INTERATIVIDADE

        // Mudar Categoria
        function setCategory(cat) {
            currentCategory = cat;
            renderCategories(); // Atualiza botões (cor)
            renderFAQs(); // Atualiza lista
        }

        // Abrir/Fechar Acordeão
        function toggleAnswer(id) {
            const content = document.getElementById(`ans-${id}`);
            const icon = document.getElementById(`icon-${id}`);
            
            // Alternar classes
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                icon.classList.remove('open');
            } else {
                // Opcional: Fechar outros abertos
                document.querySelectorAll('.answer-content').forEach(el => el.classList.remove('open'));
                document.querySelectorAll('.rotate-icon').forEach(el => el.classList.remove('open'));
                
                content.classList.add('open');
                icon.classList.add('open');
            }
        }

        // Filtrar na pesquisa
        function filterFAQs() {
            renderFAQs();
        }

        // --- MODO ADMIN ---

        function toggleAdminMode() {
            isAdmin = !isAdmin;
            const panel = document.getElementById('adminPanel');
            const btn = document.getElementById('adminToggleBtn');
            
            if (isAdmin) {
                panel.classList.remove('hidden');
                btn.classList.remove('bg-gray-100', 'text-gray-400');
                btn.classList.add('bg-red-100', 'text-red-500'); // Fica vermelho quando ativo
            } else {
                panel.classList.add('hidden');
                btn.classList.add('bg-gray-100', 'text-gray-400');
                btn.classList.remove('bg-red-100', 'text-red-500');
            }
        }

        function addNewFAQ() {
            const q = document.getElementById('newQuestion').value;
            const a = document.getElementById('newAnswer').value;
            const c = document.getElementById('newCategory').value;
            const k = document.getElementById('newKeywords').value;

            if (!q || !a) {
                alert("Por favor preencha a pergunta e a resposta.");
                return;
            }

            const newId = faqs.length > 0 ? Math.max(...faqs.map(f => f.id)) + 1 : 1;

            faqs.unshift({ // Adiciona no início da lista
                id: newId,
                category: c,
                question: q,
                answer: a,
                keywords: k
            });

            // Limpar campos
            document.getElementById('newQuestion').value = '';
            document.getElementById('newAnswer').value = '';
            document.getElementById('newKeywords').value = '';

            renderFAQs(); // Atualiza a lista visualmente
            alert("Pergunta adicionada com sucesso!");
        }

    </script>
</body>
</html>
